<!DOCTYPE html>
<html>
<head>
	<title>Subtitler</title>
</head>
<body>
	<h1>Super-Subtitler Intro page</h1>
	<h2>We are connected to: <div id='socketURL'></div></h2>
	<h3>Select a Language:</h3>
	<select>
		<option value="en" selected>English</option>
		<option value="he">Hebrew</option>
		<option value="es-MX">Spanish</option>
		<option value="fr-FR">French</option>
		<option value="de-DE">German</option>
	</select>
	<button id='start_diction'>Start</button>
</body>
<script  type="text/javascript" charset="utf-8">
		if("WebSocket" in window) {
			//MAKE SURE YOU INPUT YOUR IP ADDRESS BEFORE STARTING THE SERVER
			//we need to start Processing before we can access the socket.
			//var ws = new WebSocket('ws://192.168.1.252:8080/p5websocket');
			var ws = new WebSocket('ws://10.221.204.37:8080/p5websocket');
			console.log('socket opened', ws);

		} else {
			//not supported
			alert('WebSocket not supported');
		}

		ws.onopen = function() {
			console.log("we're connected", ws);
			document.getElementById('socketURL').innerHTML = ws.url;
		}

		ws.onclose = function() {
			console.log("we're disconnected", ws);
		}

		//start speech recognition
		//currently only Chrome supports this

		var recognition = new webkitSpeechRecognition();

		recognition.continuous = true;
		recognition.interimResults = true;
		recognition.lang = 'en-us';

		recognition.onstart = function() {
			// permission = true;
			console.log('diction started');
		}

		recognition.onend = function() {
			// permission = false;
			console.log('diction ended');
			recognition.stop();
		}

		recognition.onresult = function(event) {
			console.log(event);
			var transcript = event.results[event.results.length-1][0].transcript;

			//send to websocket
			ws.send(transcript);
		}

		recognition.start();

		start = document.getElementById('start_diction');

		start.onclick = function() {
			recognition.start();
		}

</script>
</html>